---
# Passbolt Auto-Deploy and Self-Update Configuration
# This playbook configures ansible-pull for automatic updates
# Domain: bot.thomasdev.xyz

- name: Configure Passbolt Auto-Deployment
  hosts: localhost
  become: yes
  gather_facts: yes

  pre_tasks:
    - name: Ensure local repo directory exists
      file:
        path: "{{ local_repo_path }}"
        state: directory
        mode: '0750'
      tags: [always]

    - name: Display deployment info
      debug:
        msg:
          - "Base domain: {{ base_domain }}"
          - "Passbolt domain: {{ passbolt_domain }}"
          - "Contact: {{ contact_email }}"

  roles:
    - common
    - docker
    - ssl
    - passbolt
    - firewall
    - passbolt-autofill

  post_tasks:
    - name: Configure ansible-pull for auto-updates
      include_tasks: setup_ansible_pull.yml
      tags: [autopull]
