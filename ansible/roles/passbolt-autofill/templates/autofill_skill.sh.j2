#!/bin/bash
# Passbolt Auto-fill Skill Wrapper
# Usage: passbolt-autofill <command> [args]

set -e

SCRIPT_DIR="/opt/passbolt-autofill"
CONFIG_FILE="/etc/passbolt-autofill.conf"

# Load configuration
if [[ -f "$CONFIG_FILE" ]]; then
    source "$CONFIG_FILE"
fi

# Default values
PASSBOLT_URL="${PASSBOLT_URL:-https://localhost}"
export PASSBOLT_URL

show_help() {
    cat << EOF
Passbolt Auto-fill Skill

Commands:
    health              Check Passbolt health
    search <term>      Search for credentials
    fill <url> <name> Auto-fill login form
    test                Run integration tests
    
Examples:
    passbolt-autofill health
    passbolt-autofill search "github"
    passbolt-autofill fill "https://github.com/login" "github-account"
EOF
}

case "${1:-}" in
    health)
        python3 "$SCRIPT_DIR/passbolt_client.py" health
        ;;
    search)
        if [[ -z "${2:-}" ]]; then
            echo "Usage: passbolt-autofill search <term>"
            exit 1
        fi
        python3 "$SCRIPT_DIR/passbolt_client.py" search "$2"
        ;;
    fill)
        if [[ -z "${3:-}" ]]; then
            echo "Usage: passbolt-autofill fill <url> <resource_name>"
            exit 1
        fi
        python3 "$SCRIPT_DIR/browser_autofill.py" "$2" "$3"
        ;;
    test)
        python3 "$SCRIPT_DIR/test_autofill.py"
        ;;
    help|--help|-h|"")
        show_help
        ;;
    *)
        echo "Unknown command: $1"
        show_help
        exit 1
        ;;
esac
